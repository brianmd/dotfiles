#!/bin/bash

CLO_SHARED=false
while [[ $# -gt 0 ]]; do
    if [[ $1 =~ ^[0-9]+$ ]]; then
        NUM_ARG=$1
    elif [[ $1 == "shared" ]]; then
        CLO_SHARED=true
    else
        PROJ_NAME="$1"
    fi
    shift
done
# echo "proj:$PROJ_NAME, num:$NUM_ARG, shared?:$CLO_SHARED"

if [[ $CLO_SHARED == "true" ]]; then
  WHOAMI=`whoami`
  USERID=`grep $WHOAMI /etc/passwd | cut -d: -f 3`
else
  WHOAMI=clojure
  USERID=64535
fi

DOCKER_USER_HOME="/home/$WHOAMI"
DOCKER_WORKDIR="$DOCKER_USER_HOME/project"
CURR_PATH=`pwd -P`
# BASE_DIR=`basename "$PWD"`
BASE_DIR=`basename "$CURR_PATH"`

if [[ -f $HOME/.lein/profiles.clj ]]; then
  cp $HOME/.lein/profiles.clj .docker-state/lein/
fi

# is one of these better than the other?
# SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" > /dev/null && pwd )"
# SCRIPT_DIR=`dirname "$(readlink -f $0)"`
# SCRIPT_DIR=$(dirname `readlink -f "$0"`)
SCRIPT_DIR=`dirname "$(readlink -f "$0")"`



PROJ_NAME=$BASE_DIR

mkdir -p .docker-state/m2
mkdir -p .docker-state/lein
mkdir -p .docker-state/target
mkdir -p .docker-state/log
touch .lein-env .nrepl-port figwheel_server.log
chmod a+rwx .docker-state/* .lein-env .nrepl-port figwheel_server.log
